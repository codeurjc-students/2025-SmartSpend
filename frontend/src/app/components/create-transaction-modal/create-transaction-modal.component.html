<!-- Modal backdrop -->
<div *ngIf="isVisible" class="modal-backdrop" (click)="close()">
  
  <!-- Modal content -->
  <div class="modal-content" (click)="$event.stopPropagation()">
    
    <!-- Modal header -->
    <div class="modal-header">
      <h2 class="modal-title">Nueva Transacci√≥n</h2>
      <button type="button" class="close-button" (click)="close()">‚úï</button>
    </div>

    <!-- Modal body -->
    <div class="modal-body">
      
      <!-- Error message -->
      <div *ngIf="errorMessage" class="error-alert">
        {{ errorMessage }}
      </div>

      <!-- Transaction form -->
      <form (ngSubmit)="onSubmit()" #transactionForm="ngForm">
        
        <!-- Account info (readonly) -->
        <div class="form-group">
          <label class="form-label">Cuenta</label>
          <div class="readonly-field">
            {{ currentAccount?.accountName || 'Sin cuenta seleccionada' }}
          </div>
        </div>

        <!-- Transaction title -->
        <div class="form-group">
          <label for="title" class="form-label">T√≠tulo *</label>
          <input 
            type="text" 
            id="title" 
            [(ngModel)]="newTransaction.title"
            name="title"
            class="form-input" 
            placeholder="Ej: Compra supermercado, N√≥mina..."
            required
            maxlength="30">
        </div>

        <!-- Transaction type -->
        <div class="form-group">
          <label class="form-label">Tipo de transacci√≥n *</label>
          <div class="radio-group">
            <label class="radio-option">
              <input 
                type="radio" 
                [(ngModel)]="newTransaction.type" 
                name="type"
                value="EXPENSE"
                (change)="onTransactionTypeChange()"
                required>
              <span class="radio-custom expense">üí∏ Gasto</span>
            </label>
            <label class="radio-option">
              <input 
                type="radio" 
                [(ngModel)]="newTransaction.type" 
                name="type"
                value="INCOME"
                (change)="onTransactionTypeChange()"
                required>
              <span class="radio-custom income">üí∞ Ingreso</span>
            </label>
          </div>
        </div>

        <!-- Category selection -->
        <div class="form-group">
          <label for="category" class="form-label">Categor√≠a *</label>
          <div *ngIf="isLoadingCategories" class="loading-text">
            Cargando categor√≠as...
          </div>
          <select 
            *ngIf="!isLoadingCategories"
            id="category" 
            [(ngModel)]="newTransaction.categoryId"
            name="categoryId"
            class="form-select" 
            required>
            <option value="">Seleccionar categor√≠a</option>
            <option 
              *ngFor="let category of availableCategories" 
              [value]="category.id">
              {{ category.icon }} {{ category.name }}
            </option>
          </select>
        </div>

        <!-- Amount -->
        <div class="form-group">
          <label for="amount" class="form-label">Cantidad *</label>
          <div class="amount-input-group">
            <span class="currency-symbol">‚Ç¨</span>
            <input 
              type="number" 
              id="amount" 
              [(ngModel)]="newTransaction.amount"
              name="amount"
              class="form-input amount-input" 
              placeholder="0.00"
              step="0.01"
              min="0.01"
              required>
          </div>
        </div>

        <!-- Date -->
        <div class="form-group">
          <label for="date" class="form-label">Fecha</label>
          <input 
            type="date" 
            id="date" 
            [(ngModel)]="newTransaction.date"
            name="date"
            class="form-input">
          <small class="form-help">Si no seleccionas una fecha, se usar√° la fecha actual</small>
        </div>

        <!-- Recurrence -->
        <div class="form-group">
          <label for="recurrence" class="form-label">Recurrencia</label>
          <select 
            id="recurrence" 
            [(ngModel)]="newTransaction.recurrence"
            name="recurrence"
            class="form-select">
            <option value="NONE">Sin recurrencia</option>
            <option value="DAILY">Diaria</option>
            <option value="WEEKLY">Semanal</option>
            <option value="MONTHLY">Mensual</option>
            <option value="YEARLY">Anual</option>
          </select>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description" class="form-label">Descripci√≥n</label>
          <textarea 
            id="description" 
            [(ngModel)]="newTransaction.description"
            name="description"
            class="form-textarea" 
            placeholder="Descripci√≥n adicional (opcional)"
            rows="3"
            maxlength="100"></textarea>
          <small class="form-help">M√°ximo 100 caracteres</small>
        </div>

        <!-- Action buttons -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn-secondary" 
            (click)="close()"
            [disabled]="isLoading">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-primary"
            [disabled]="!isFormValid() || isLoading">
            <span *ngIf="isLoading">Creando...</span>
            <span *ngIf="!isLoading">Crear Transacci√≥n</span>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>