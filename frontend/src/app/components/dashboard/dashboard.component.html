<div class="dashboard-container">
  <div class="dashboard-card">

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-section">
      <p>Cargando cuentas...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !showCreateAccountForm" class="error-section">
      <div class="error-message">{{ errorMessage }}</div>
      <button class="btn-secondary" (click)="loadUserAccounts()">ğŸ”„ Reintentar</button>
    </div>

    <!-- Empty State - No hay cuentas -->
    <div *ngIf="accounts.length === 0 && !isLoading && !showCreateAccountForm" class="empty-section">
      <h3>Â¡Bienvenido a Smart Spend!</h3>
      <p>Comienza creando tu primera cuenta bancaria para gestionar tus finanzas.</p>
      <button class="btn-primary" (click)="createFirstAccount()">
        â• Crear Primera Cuenta
      </button>
    </div>

    <!-- Modal para crear cuenta -->
    <div *ngIf="showCreateAccountForm" class="modal-overlay" (click)="closeCreateAccountModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Nueva Cuenta Bancaria</h3>
          <button class="close-btn" (click)="closeCreateAccountModal()">âœ•</button>
        </div>

        <form (ngSubmit)="createAccount()" class="modal-form">
          <div class="form-group">
            <label for="accountName">Nombre de la cuenta:</label>
            <input type="text" id="accountName" [(ngModel)]="newAccountName" name="accountName"
              placeholder="Ej: Cuenta Principal, Ahorros..." class="form-control" [disabled]="isCreatingAccount"
              required maxlength="50">
          </div>
          <div class="form-group">
            <label for="initialBalance">Saldo inicial:</label>
            <input type="number" id="initialBalance" [(ngModel)]="initialBalance" name="initialBalance"
              placeholder="0.00" class="form-control" [disabled]="isCreatingAccount" required>
          </div>

          <!-- Mensaje de error dentro del modal -->
          <div *ngIf="errorMessage" class="error-message">
            {{ errorMessage }}
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeCreateAccountModal()"
              [disabled]="isCreatingAccount">
              Cancelar
            </button>
            <button type="submit" class="btn-primary" [disabled]="isCreatingAccount || !newAccountName.trim()">
              {{ isCreatingAccount ? 'Creando...' : 'Crear Cuenta' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main Content (solo si hay cuentas y el modal no estÃ¡ abierto) -->
    <div *ngIf="accounts.length > 0 && !showCreateAccountForm && !isLoading" class="main-content">

      <!-- Account Card Section -->
      <div class="account-section">

        <!-- Navigation Arrow Left -->
        <button *ngIf="accounts.length > 1" class="nav-arrow nav-left" (click)="previousAccount()">
          â†
        </button>

        <!-- Account Card -->
        <div class="account-card" *ngIf="currentAccount">

          <!-- Account Type -->
          <div class="account-type">
            {{ currentAccount.accountName.toUpperCase() }}
          </div>

          <!-- Balance Display -->
          <div class="balance-display">
            <span class="balance-amount">
              {{currentAccount.currentBalance | currency:'EUR':'symbol':'1.2-2'}}
            </span>
          </div>

          <!-- Transaction List Component -->

          <app-transaction-list [accountId]="currentAccount.id"
            (addTransactionClick)="onAddTransactionFromList()"
            (transactionDeletedSuccess)="onTransactionDeletedSuccess()">
          </app-transaction-list>


          <!-- Create transaction Modal Component -->
          <app-create-transaction-modal [isVisible]="showCreateTransactionModal" [currentAccount]="currentAccount"
            (closeModal)="onCloseCreateTransactionModal()" (transactionCreated)="onTransactionCreated($event)" >
          </app-create-transaction-modal>



          <!-- Navigation Arrow Right -->
          <button *ngIf="accounts.length > 1" class="nav-arrow nav-right" (click)="nextAccount()">
            â†’
          </button>
        </div>

        <!-- Page Indicators (dots) -->
        <div *ngIf="accounts.length > 1" class="page-indicators">
          <button *ngFor="let account of accounts; let i = index" class="indicator"
            [class.active]="i === currentAccountIndex" (click)="goToAccount(i)" [title]="account.accountName">
          </button>
        </div>



        <!-- Account Management (Gestionar, Nueva Cuenta) -->
        <div class="account-management">

          <button class="btn-primary" (click)="createNewAccount()" [disabled]="accounts.length >= 3">
            â• Nueva Cuenta
            <span *ngIf="accounts.length >= 3" class="disabled-text">(MÃ¡ximo 3)</span>
          </button>
        </div>

      </div>

      <!-- Success Message (fuera del modal, para que se vea siempre) -->
      <div *ngIf="successMessage && !showCreateAccountForm" class="success-message">
        {{ successMessage }}
      </div>

    </div>
  </div>